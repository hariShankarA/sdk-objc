syntax = "proto3";
package io.token.proto.common.transfer;

option java_outer_classname = "TransferProtos";

import "money.proto";
import "security.proto";


// A transfer record as persisted on the ledger.
message Transfer {
  string id = 1;                               // Computed as the hash of the transfer payload.
  string reference_id = 2;                     // Bank transaction reference id.
  Payload payload = 3;
  int64 created_at_ms = 4;
  repeated io.token.proto.common.security.Signature payload_signatures = 5;

  message Payload {
    string nonce = 1;                                                     // Client assigned unique request id.
    string token_id = 2;                                                  // Token id.
    io.token.proto.common.money.Money amount = 3;                         // Amount and currency.
    io.token.proto.common.transfer.TransferInstructions instructions = 5; // Transfer instructions.
    string description = 6;                                               // Optional
  }
}

// Money transfer instructions.
message TransferInstructions {
  Source source = 1;                           // Transfer source.
  repeated Destination destination = 2;        // Transfer desitination.
}

// Money transfer source. This could be an transferDest id assigned by Token or
// real bank transferDest number.
message Source {
  oneof source {
    string account_id = 1;
    string account_number = 2;
  }
}

// Money transfer destination. The desitination is described differently
// depending on the transfer method being used.
message Destination {
  oneof destination {
    DestinationBic swift = 1;
    DestinationIban iban = 2;
    DestinationAch ach = 3;
  }
}

// SWIFT transfer destination.
message DestinationBic {
  string bic = 1;
  string account = 2;
}

// IBAN transfer destination, can be used with different transfer methods.
message DestinationIban {
  enum Method { INVALID = 0; SWIFT = 1; SEPA = 2; }

  Method method = 1;
  string iban = 2;
  string name = 3;
}

// ACH transfer destination.
message DestinationAch {
  string routing = 1;
  string account = 2;
}
