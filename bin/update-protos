#!/bin/bash
dir=$(dirname $0)'/..'
pushd $dir > /dev/null
currentVersion=$(cat podfile | grep '^TOKEN_PROTOS_VER' | cut -d '"' -f 2)
lastestVersion=$(jfrog rt search "libs-release/io/token/proto/tokenio-proto-common/*.pom" | grep "path" | tail -n 1 | cut  -d '/' -f 6)
echo 'The current proto version is '$currentVersion
echo 'The latest proto version is '$lastestVersion

if [ "$currentVersion" != "$lastestVersion" ]; then
    echo 'Updating the proto...'
    sed -i.bak -E 's/^TOKEN_PROTOS_VER = \"[0-9\.]+\"/TOKEN_PROTOS_VER = \"'$lastestVersion'\"/' Podfile
    rm Podfile.bak
    pod update
    echo 'Updated to lastest version'
else 
    echo 'No need to update'
fi 

popd > /dev/null

